<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        [text]="getBackButtonText()"
        defaultHref="/tabs/tab4"
      ></ion-back-button>
    </ion-buttons>
    <ion-title>Quiz</ion-title>
    <ion-progress-bar
      *ngIf="loaded && !showScore"
      [value]="(currentIndex + 1) / questions.length"
    ></ion-progress-bar>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Quiz</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-refresher
    *ngIf="!loaded"
    slot="fixed"
    (ionRefresh)="handleRefresh($event)"
  >
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-card *ngIf="loaded && !showScore" class="animation-opacity">
    <ion-card-header class="title-question">
      <p><b [innerHTML]="questions[currentIndex].question"></b></p>
      <ion-note [innerHTML]="questions[currentIndex].category"></ion-note>
      <br />
      <ion-card-title color="primary">
        <b> Question {{ currentIndex+1 + '/' + questions.length }} </b>
      </ion-card-title>
    </ion-card-header>

    <ion-card>
      <ion-card-header>
        <h3>Your answer</h3>
      </ion-card-header>
      <ion-grid>
        <ion-row>
          <ion-col
            size="12"
            *ngFor="let answer of questions[currentIndex].mergedAnswers"
            (click)="selectAnswer(questions[currentIndex], answer)"
            class="answer-card"
          >
            <ion-card
              [color]="selectedAnswer === answer && isAnswered ? 'success' : 'secondary'"
              class="ion-no-margin"
            >
              <ion-card-content
                ><div [innerHTML]="answer"></div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>

    <ion-card
      *ngIf="isAnswered && selectedAnswer !== questions[currentIndex].correct_answer"
      color="danger"
      class="animation-opacity"
    >
      <ion-card-content [innerHTML]="questions[currentIndex].correct_answer">
      </ion-card-content>
    </ion-card>
    <ion-card class="card-no-borders answer-btn" *ngIf="questions.length > 0">
      <!-- <ion-button
        shape="round"
        fill="clear"
        color="dark"
        (click)="onPrevious()"
        *ngIf="currentIndex !== 0"
      >
        <ion-icon name="chevron-back" slot="start"></ion-icon>
        Back
      </ion-button> -->

      <ion-button
        shape="round"
        fill="clear"
        [disabled]="!isAnswered"
        color="primary"
        (click)="onNext()"
        *ngIf="currentIndex < questions.length - 1"
      >
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
        Next
      </ion-button>

      <ion-button
        shape="round"
        fill="clear"
        [disabled]="!isAnswered"
        color="tertiary"
        (click)="viewScore()"
        *ngIf="currentIndex === questions.length - 1"
      >
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
        View result
      </ion-button>
    </ion-card>
  </ion-card>

  <!-- skeleton -->

  <ion-card *ngIf="!loaded">
    <ion-card class="card-no-borders">
      <ion-card-header>
        <ion-card-subtitle
          ><ion-skeleton-text
            [animated]="true"
            style="width: 35%"
          ></ion-skeleton-text
        ></ion-card-subtitle>
        <br />
        <ion-card-title
          ><ion-skeleton-text
            [animated]="true"
            style="width: 70%"
          ></ion-skeleton-text
        ></ion-card-title>
      </ion-card-header>
    </ion-card>
    <ion-card>
      <ion-card-header>
        <h3>Loading...</h3>
      </ion-card-header>
      <ion-grid>
        <ion-row>
          <ion-col size="12">
            <ion-card class="ion-no-margin card-no-borders">
              <ion-card-content
                ><ion-skeleton-text
                  [animated]="true"
                  style="width: 100%"
                ></ion-skeleton-text
              ></ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>
  </ion-card>

  <!-- skeleton -->

  <ion-card
    class="card-no-borders animation-opacity"
    *ngIf="loaded && showScore"
  >
    <div>
      <h2 class="ion-text-center">
        <ion-text color="tertiary">Your score</ion-text>
      </h2>
      <h3 class="ion-text-center score">
        <ion-text color="tertiary">{{score}}</ion-text>
      </h3>
    </div>
    <div class="save-btn">
      <ion-button
        color="light"
        shape="round"
        (click)="refreshData()"
        id="open-loading"
        ><ion-icon name="game-controller" slot="start"></ion-icon
        >Retry</ion-button
      >
      <ion-button
        *ngIf="score !== 0"
        [disabled]="stateSaveScore"
        color="secondary"
        shape="round"
        (click)="saveScore({pseudo: 'User ' + getRndInteger(1,1500), score: score})"
        id="open-loading"
        ><ion-icon
          [name]="stateSaveScore ? 'checkmark-done' : 'save'"
          slot="start"
        ></ion-icon
        >{{ stateSaveScore ? 'Saved' : 'Save score' }}</ion-button
      >
    </div>
  </ion-card>
</ion-content>
